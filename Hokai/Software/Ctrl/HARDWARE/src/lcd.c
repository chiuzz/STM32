/***  深圳精东断码屏显示驱动代码***/
/***  ljy修改 版本1.0***/
#include "LCD.h"
#include "delay.h"

void LCD_IO_Init(void)
{   	 
//  GPIO_InitTypeDef  GPIO_InitStructure;

//  RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOD, ENABLE); 	
//	GPIO_InitStructure.GPIO_Pin = GPIO_Pin_12 |GPIO_Pin_13|GPIO_Pin_14|GPIO_Pin_15 ;  
//	GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;          
//	GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;          
//	GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz; 
//	GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_UP;//上拉
//	GPIO_Init(GPIOD, &GPIO_InitStructure); 	
//	
//  GPIO_SetBits(GPIOD, GPIO_Pin_12);
//	GPIO_SetBits(GPIOD, GPIO_Pin_13);
//	GPIO_SetBits(GPIOD, GPIO_Pin_14);
//	GPIO_SetBits(GPIOD, GPIO_Pin_15);
}
//********************************************************************************************************
//* 函 数 名 : write_lcd_data(unsigned short int address,unsigned  char _data,Bool _cs)  
//**------------------------------------------------------------------------------------------------------
//* 描    述 : 向芯片1写入一个数据
//**------------------------------------------------------------------------------------------------------
//* 输入参数 : unsigned short int address      写入数据的地址
//			   unsigned short int data		   写入的数据
//			   Bool _cs						   驱动芯片
//**------------------------------------------------------------------------------------------------------
//* 输出参数 : None
//**------------------------------------------------------------------------------------------------------
//* 返    回 : None
//******************************************************************************************************** 


void HT1621Wr_Data(u8 dat ,u8 dat_lengh) 
{
	u8 i; 
	for(i =0; i <dat_lengh; i ++)
	{
		 if((dat&0x80)==0)
		 {
				LCDDATA_LOW;
		 }
		 else 
		 {
				LCDDATA_HIGH;
		 }
			LCDWR_LOW
			delay_us(20);
			LCDWR_HIGH;
			delay_us(20);
			dat<<=1;
	}
	      
}
//********************************************************************************************************
//* 函 数 名 : send_lcd_command(unsigned char command,Bool _cs) 
//**------------------------------------------------------------------------------------------------------
//* 描    述 : 向芯片1发送一个命令
//**------------------------------------------------------------------------------------------------------
//* 输入参数 : unsigned char command    发生的命令
//			   Bool _cs					驱动芯片
//**------------------------------------------------------------------------------------------------------
//* 输出参数 : None
//**------------------------------------------------------------------------------------------------------
//* 返    回 : None
//********************************************************************************************************
void HT1621WrCmd(u8 Cmd ,u8 WhichCS)
{
	if(WhichCS==IC1_PIN)
	{
		LCDCS1_LOW;
		delay_us(20);
		HT1621Wr_Data(0x80,4); 
		HT1621Wr_Data(Cmd,8);
		delay_us(20);
		LCDCS1_HIGH;
	}
	else if(WhichCS==IC2_PIN)
	{
		LCDCS2_LOW;
		delay_us(20);
		HT1621Wr_Data(0x80,4); 
		HT1621Wr_Data(Cmd,8); 
		delay_us(20);
		LCDCS2_HIGH
	}
	
}



//********************************************************************************************************
//* 函 数 名 : void lcd_init(void)   
//**------------------------------------------------------------------------------------------------------
//* 描    述 : 芯片初始化
//**------------------------------------------------------------------------------------------------------
//* 输入参数 : None
//**------------------------------------------------------------------------------------------------------
//* 输出参数 : None
//**------------------------------------------------------------------------------------------------------
//* 返    回 : None
//******************************************************************************************************** 
void HT1621B_Init(void) 
{ 
	LCDCS1_HIGH;
	LCDCS2_HIGH;
	LCDWR_HIGH;
	LCDDATA_HIGH;
	
	delay_ms(1);
	HT1621WrCmd(0x00,IC1_PIN);       
	HT1621WrCmd(0x04,IC1_PIN); 
	HT1621WrCmd(0x30,IC1_PIN); 
	HT1621WrCmd(0x02,IC1_PIN); 
	HT1621WrCmd(0x06,IC1_PIN); 
	HT1621WrCmd(0x52,IC1_PIN); 
	HT1621WrCmd(0x80,IC1_PIN);

	HT1621WrCmd(0x00,IC2_PIN);       
	HT1621WrCmd(0x04,IC2_PIN); 
	HT1621WrCmd(0x30,IC2_PIN); 
	HT1621WrCmd(0x02,IC2_PIN); 
	HT1621WrCmd(0x06,IC2_PIN); 
	HT1621WrCmd(0x52,IC2_PIN); 
	HT1621WrCmd(0x80,IC2_PIN);
	delay_ms(20);
	
}

void HT1621B_InitiIC1(void) 
{ 
	LCDCS1_HIGH;
	LCDCS2_HIGH;
	LCDWR_HIGH;
	LCDDATA_HIGH;
	
	delay_ms(1);
	HT1621WrCmd(0x00,IC1_PIN);       
	HT1621WrCmd(0x04,IC1_PIN); 
	HT1621WrCmd(0x30,IC1_PIN); 
	HT1621WrCmd(0x02,IC1_PIN); 
	HT1621WrCmd(0x06,IC1_PIN); 
	HT1621WrCmd(0x52,IC1_PIN); 
	HT1621WrCmd(0x80,IC1_PIN);
	delay_ms(20);
	
}
//********************************************************************************************************
//* 函 数 名 : BuzzeOn(void)
//**------------------------------------------------------------------------------------------------------
//* 描    述 : 蜂鸣器开
//**------------------------------------------------------------------------------------------------------
//* 输入参数 : None
//**------------------------------------------------------------------------------------------------------
//* 输出参数 : None
//**------------------------------------------------------------------------------------------------------
//* 返    回 : None
//********************************************************************************************************
void BuzzeOn(void)
{
	HT1621WrCmd(TONEON,IC2_PIN);
	//HT1621WrCmd(TONEON,CS1);
}


//********************************************************************************************************
//* 函 数 名 : BuzzeOn(void)
//**------------------------------------------------------------------------------------------------------
//* 描    述 : 蜂鸣器关
//**------------------------------------------------------------------------------------------------------
//* 输入参数 : None
//**------------------------------------------------------------------------------------------------------
//* 输出参数 : None
//**------------------------------------------------------------------------------------------------------
//* 返    回 : None
//********************************************************************************************************
void BuzzeOff(void)
{
	HT1621WrCmd(TONEOFF,IC2_PIN);
	//HT1621WrCmd(TONEOFF,CS1);
}

//????:void Ht1621WrOneData(uchar Addr,uchar Data)
//????: HT1621???????????
//????:Addr???????,Data?????
//? ?:??HT1621????4?,?????????????4?
//-----------------------------------------------------------------------------------------
void HT1621WrOneData(u8 Addr,u8 Data ,u8 WhichIC)
{
		if(WhichIC==IC1_PIN)
		{
			LCDCS1_LOW; 
			delay_ms(1);
			HT1621Wr_Data(0xa0,3); //??????101
			HT1621Wr_Data(Addr<<2,6); //??????
			HT1621Wr_Data(Data<<4,4); //????
			LCDCS1_HIGH;//
			delay_ms(1);
		}	
		if(WhichIC==IC2_PIN)
		{
			LCDCS2_LOW; 
			delay_ms(1);
			HT1621Wr_Data(0xa0,3); //??????101
			HT1621Wr_Data(Addr<<2,6); //??????
			HT1621Wr_Data(Data<<4,4); //????
			LCDCS2_HIGH;//
			delay_ms(1);
		}	
	
		
}

//********************************************************************************************************
//* 函 数 名 : void disp_all()
//**------------------------------------------------------------------------------------------------------
//* 描    述 :  全屏点亮
//**------------------------------------------------------------------------------------------------------
//* 输入参数 : None
//**------------------------------------------------------------------------------------------------------
//* 输出参数 : None
//**------------------------------------------------------------------------------------------------------
//* 返    回 : None
//********************************************************************************************************
void disp_all()
{
	char i;
	for(i=0;i<31;i++)
	{
		HT1621WrOneData(i,0xff,IC1_PIN);
		HT1621WrOneData(i,0xff,IC2_PIN);
	}
}

//********************************************************************************************************
//* 函 数 名 : void disp_clear()
//**------------------------------------------------------------------------------------------------------
//* 描    述 : 清屏
//**------------------------------------------------------------------------------------------------------
//* 输入参数 : None
//**------------------------------------------------------------------------------------------------------
//* 输出参数 : None
//**------------------------------------------------------------------------------------------------------
//* 返    回 : None
//********************************************************************************************************
void disp_clear()
{
	char i;
	for(i=0;i<31;i++)
	{
		HT1621WrOneData(i,0x0,IC1_PIN);
		HT1621WrOneData(i,0x0,IC2_PIN);
	}
}